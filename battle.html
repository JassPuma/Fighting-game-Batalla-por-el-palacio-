<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Batalla por el Palacio</title>
<link rel="stylesheet" href="style.css">
<style>
body, html {
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  font-family: Arial, sans-serif;
  overflow:hidden;
  background:black;
}

/* Contenedor principal */
#main-game {
  width:100vw;
  height:100vh;
  position:relative;
}

/* Video de fondo */
#battle-video {
  position:absolute;
  top:0; left:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:0;
}

/* Canvas sobre el video */
#gameCanvas {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:1;
  display:block;
}

/* Barras de vida y pausa */
#health-bar-container {
  position:absolute;
  top:10px;
  left:10px;
  right:10px;
  height:40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:2;
}

.health-bar {
  width:300px;
  height:20px;
  background:red;
  border:2px solid black;
  border-radius:5px;
  overflow:hidden;
}

.health-fill {
  height:100%;
  background:green;
  width:100%;
  transition: width 0.2s;
}

#pause-button {
  padding:5px 10px;
  font-size:16px;
  cursor:pointer;
}

/* Pantalla Win */
#win-screen {
  display:none;
  position:absolute;
  width:100%;
  height:100%;
  background:black;
  color:white;
  text-align:center;
  z-index:3;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

#skip-win {
  position:absolute;
  top:10px;
  right:10px;
  padding:5px 10px;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="main-game">

  <!-- Video de fondo -->
  <video id="battle-video" autoplay muted loop playsinline>
    <source src="assets/videos/congreso.mp4" type="video/mp4">
  </video>

  <!-- Canvas para los personajes -->
  <canvas id="gameCanvas"></canvas>

  <!-- Barras de vida y pausa -->
  <div id="health-bar-container">
    <div class="health-bar">
      <div id="player-health" class="health-fill"></div>
    </div>
    <button id="pause-button">PAUSE</button>
    <div class="health-bar">
      <div id="opponent-health" class="health-fill"></div>
    </div>
  </div>

  <!-- Pantalla Win -->
  <div id="win-screen">
    <h1>YOU WIN!</h1>
    <div id="winner-name"></div>
    <button id="skip-win">Skip</button>
  </div>

</div>

<script src="characters.js"></script>
<script>
// Canvas setup
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let paused = false;
let gameOver = false;
let remaining = JSON.parse(sessionStorage.getItem("remainingCandidates")) || [];

// Clase Fighter
class Fighter {
  constructor(name,imgSrc,x,y){
    this.name = name;
    this.img = new Image();
    this.img.src = imgSrc;
    this.loaded = false;
    this.img.onload = () => { this.loaded = true; }
    this.x = x;
    this.y = y;
    this.width = 100;
    this.height = 100;
    this.health = 100;
    this.speed = 5;
  }
  draw(){
    if(this.loaded) ctx.drawImage(this.img,this.x,this.y,this.width,this.height);
  }
}

// Jugador
const playerData = JSON.parse(sessionStorage.getItem("selectedCharacter"));
const player = new Fighter(playerData.name, playerData.img, 100, canvas.height-150);

// Enemigo inicial
let currentEnemyData = remaining.splice(Math.floor(Math.random()*remaining.length),1)[0];
const enemy = new Fighter(currentEnemyData.name, currentEnemyData.img, canvas.width-200, canvas.height-150);

// Teclado
const keys = {};
window.addEventListener("keydown", e=>{ keys[e.key]=true; });
window.addEventListener("keyup", e=>{ keys[e.key]=false; });

// Pausa
document.getElementById("pause-button").addEventListener("click", ()=>{ paused = !paused; });

// Win skip
document.getElementById("skip-win").addEventListener("click", ()=>{
  document.getElementById("win-screen").style.display='none';
  startNextBattle();
});

// Función para iniciar siguiente combate
function startNextBattle(){
  if(remaining.length===0){
    document.getElementById("win-screen").style.display='flex';
    document.getElementById("winner-name").textContent=player.name;
    setTimeout(()=>{ /* redirigir o reiniciar */ },10000);
  }else{
    let nextData = remaining.splice(Math.floor(Math.random()*remaining.length),1)[0];
    enemy.name = nextData.name;
    enemy.img.src = nextData.img;
    enemy.health=100;
    player.health=100;
    updateHealthBars();
    gameOver=false;
  }
}

// Actualizar barras
function updateHealthBars(){
  document.getElementById("player-health").style.width = player.health+'%';
  document.getElementById("opponent-health").style.width = enemy.health+'%';
}

// Loop principal
function animate(){
  requestAnimationFrame(animate);
  if(paused || gameOver) return;

  // Limpiar canvas con transparencia para ver el video
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Movimiento jugador
  if(keys["ArrowLeft"]) player.x = Math.max(0, player.x-player.speed);
  if(keys["ArrowRight"]) player.x = Math.min(canvas.width-player.width, player.x+player.speed);

  // Golpe simple
  if(keys[" "]) enemy.health = Math.max(0, enemy.health-0.5);

  // IA enemiga básica
  if(enemy.x > player.x+player.width) enemy.x -= 2;
  if(enemy.x+enemy.width < player.x) enemy.x += 2;

  // Evitar que se atraviesen
  if(player.x + player.width > enemy.x && player.x < enemy.x + enemy.width){
    if(keys["ArrowRight"]) player.x = enemy.x - player.width;
    if(keys["ArrowLeft"]) player.x = enemy.x + enemy.width;
  }

  // Dibujar personajes
  player.draw();
  enemy.draw();

  // Actualizar barras
  updateHealthBars();

  // Fin de combate
  if(player.health<=0 || enemy.health<=0){
    gameOver=true;
    setTimeout(()=>{ startNextBattle(); },1000);
  }
}
animate();
</script>
</body>
</html>




